uptrend = True
uptrend = True
HH = 0
HL = 0.98847
HHs = []
HLs = []
confirmed_HL = 0
LH_currentPrice_distance = 0

downtrend = False
LL = 1000
LH = 0
LLs = []
LHs = []
confirmed_LH = 1000
LH_currentPrice_distance = 0

for _, row in df.iterrows():

    if uptrend == True:

        # Checking for continuation BOS
        if len(HLs) > 0:
            if HH < row.mid_c:
                HLs.sort()
                HL = HLs[0]
                HLs = []
                uptrend = True
                confirmed_HL = HL
                print("BOS", f'Current Price: {row.mid_c}. Uptrend: {uptrend}. Confirmed HL: {confirmed_HL}')
                print(f"Confirmed HH: {HH}.")

        # Checking for new HH (no BOS)
        if row.mid_c > HH:
            HH = row.mid_c
            HHs.append(HH)
        #             print(f"New HH: {HH}")

        # Max Dist calculation
        HL_to_HH_max_distance = HH - HL
        # Retracement Point calculation
        fib_38_retracement_point = HL + (HL_to_HH_max_distance * 0.62)

        # Checking Retracement %
        if row.mid_c < fib_38_retracement_point:
            HLs.append(row.mid_c)
            HLs.sort()
            HL = HLs[0]
        #             print(HL, "Current HL")

        # Checking for reversal BOS
        if row.mid_c < confirmed_HL:
            uptrend = False
            downtrend = True
            LH = HH
            print(f"REVERSAL. Current price: {row.mid_c}. \n Downtrend = {downtrend}. Uptrend = {uptrend} \n HL: {LH}")

    if downtrend == True:

        # Checking for continuation BOS
        if len(LHs) > 0:
            if LL > row.mid_c:
                LHs.sort()
                LH = LHs[0]
                LHs = []
                downtrend = True
                confirmed_LH = LH
                print("BOS", f'Current Price: {row.mid_c}. Downtrend: {downtrend}. Confirmed LH: {confirmed_LH}')
                print(f"Confirmed LL: {LL}.")

        # Checking for new LL (no BOS)
        if row.mid_c < LL:
            LL = row.mid_c
            LLs.append(LL)
            print(f"New LL: {LL}")

        # Max Dist calculation
        LH_to_LL_max_distance = LH - LL
        # Retracement Point calculation
        fib_38_retracement_point = LL + (LH_to_LL_max_distance * 0.38)

        # Checking Retracement %
        if row.mid_c > fib_38_retracement_point:
            LHs.append(row.mid_c)
            LHs.sort()
            LH = LHs[-1]
            print(LH, "Current LH")

        # Checking for BOS
        if row.mid_c > confirmed_LH:
            uptrend = True
            downtrend = False
            HL = LL
            print(f"REVERSAL. Current price: {row.mid_c}. Downtrend = {downtrend}. Uptrend = {uptrend}")